{{ define "games/show.html" }}
<!DOCTYPE html>
<html>
    <head>
        <title>51</title>
        <style>
            table, tr, th, td {
                border: 1px solid black;
                border-collapse: collapse;
            }
        </style>
        <script>
            function roll(dice) {
                event.preventDefault();
                fetch("/games/"+{{.game.ID}}+"/roll",
                    { method:"POST", body: JSON.stringify({ dice: parseInt(dice, 10) }) })
                    .then((response) => response.json())
                    .then((v) => console.log(v));
            }
            function joinGame(gameId, userName) {
                event.preventDefault();
                fetch("/games/"+gameId+"/join",
                    { method:"POST", body: JSON.stringify({ userName: userName }) })
                    .then((response) => response.json())
                    .then((v) => console.log(v));
            }
        </script>
    </head>
    <body>
        {{if eq .user nil }} 
        <h1>Hello!</h1>
        {{else}}
        <h1>Hello, {{.user.Name}}!</h1>
        {{end}}
        <h2>Game {{ .game.ID }}</h2>
        <h3>Players</h3>
        <ul id="players-list">
            {{ range $player := .game.Players }}
                <li>{{ $player.Name }}</li>
            {{ end }}
        </ul>
        <form method="post" action="/games/{{.game.ID}}/join" onsubmit="joinGame({{.game.ID}}, userName.value); return false">
            <input name="userName" type="text" placeholder="Enter your COOL nickname!">
            <input type="submit" value="Join">
        </form>
        <table id="turns">
            <tr>
                {{ range $player := .game.Players }}
                <th>{{$player.Name}}</th>
                {{ end }}
            </tr>
            {{ range $round := .rounds }}
            <tr>
                {{ range $turn := $round }}
                <td>{{$turn.Result}}</td>
                {{ end }}
            </tr>
            {{ end }}
        </table>
        <form method="post" action="/games/{{.game.ID}}/roll" onsubmit="roll(dice.value)">
            <select name="dice">
                <option value="4">d4</option>
                <option value="12">d12</option>
                <option value="20" selected>d20</option>
                <option value="100">d100</option>
            </select>
            <input type="submit" value="Roll!">
        </form>
    </body>
</html>
{{ end }}
